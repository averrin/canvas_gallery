<!DOCTYPE HTML>
<html>
<head>
    <style>
        body {
            margin: 0px;
            padding: 0px;
            background-color: #1f1f1f;
        }
    </style>
</head>
<body>
<div style="position: relative;">
    <canvas id="layer1" width="100" height="100"
            style="position: absolute; left: 0; top: 0; z-index: 0;"></canvas>
    <canvas id="layer2" width="100" height="100"
            style="position: absolute; left: 0; top: 0; z-index: 1;"></canvas>
</div>
<script>
window.requestAnimFrame = (function (callback) {
    return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
            function (callback) {
                window.setTimeout(callback, 1000 / 60);
            };
})();


var canvas = document.getElementById('layer1');
var fgcanvas = document.getElementById('layer2');
var context = canvas.getContext('2d');
var fgcontext = fgcanvas.getContext('2d');
window.onresize = recalc;
var selectedImage = {key: "", in_zoom: false};
window.defaultState = "";

function reset() {
    context.clearRect(0, 0, canvas.width, canvas.height);
    // load image from data url
    var imageObj = new Image();
    imageObj.onload = function () {
        context.drawImage(this, 0, 0);
    };

    imageObj.src = window.defaultState;
}

function redraw() {
    context.clearRect(0, 0, canvas.width, canvas.height);
    for (var i in images) {
        drawImage(i, context);
    }

    var s = "Use -> and <- keys for item selection; Enter - toggle zoom";
    context.font = '20pt Calibri';
    context.fillStyle = '#1f1f1f';
    context.fillStyle = '#eee';
    context.fillText(s, 40, window.innerHeight - 20 - 8);
    window.defaultState = canvas.toDataURL("image/png");
}
function recalc() {
    context.canvas.width = window.innerWidth - 40;
    context.canvas.height = window.innerHeight - 20;
    fgcontext.canvas.width = window.innerWidth - 40;
    fgcontext.canvas.height = window.innerHeight - 20;
    var hoffset = 40;
    var voffset = 40;
    var h = 180;

    for (var i in images) {
        var img = images[i].img;
        var k = h / img.height;
        var w = img.width * k;
        if (hoffset + w > window.innerWidth) {
            voffset += h;
            hoffset = 40;
        }
        images[i].rect = {
            y0: voffset,
            x0: hoffset,
            x1: w,
            y1: h
        };
        hoffset += w;
    }

    redraw();
}

var images = {};

// do cool things with the context
function loadImages(sources, callback) {
    var loadedImages = 0;
    var numImages = 0;
    // get num of sources
    for (var src in sources) {
        numImages++;
    }
    for (var src in sources) {
        images[src] = {}
        images[src].img = new Image();
        // images[src].img.setAttribute('crossOrigin', 'anonymous');
        images[src].img.onload = function () {
            if (++loadedImages >= numImages) {
                callback(images);
            }
        };
        images[src].img.src = sources[src];
        images[src].title = src;
    }
}

var sources = {
    stairs: 'images/one.jpg',
    sky: 'images/two.jpg',
    view: 'images/three.jpg',
    shadowrun: 'images/four.jpg',
    light: 'images/five.jpg',
    highway: 'images/six.jpg',
    poster: 'images/seven.jpg',
    bridge: 'images/eight.jpg',
    rain: 'images/nine.jpg',
    roof: 'images/10.jpg',
    clouds: 'images/11.jpg',
    night: 'images/12.jpg'
};

function drawImage(key, ctx) {
    if (typeof key == "string") {
        var image = images[key];
    } else {
        image = key;
    }
    var rect = image.rect;
    ctx.drawImage(image.img, rect.x0, rect.y0, rect.x1, rect.y1);
}

function zoom(key, startTime, in_zoom) {
    var image = images[key];
    var rect = image.rect;
    var time = (new Date()).getTime() - startTime;
    var speed = 3;
    if (!in_zoom) {
        var oz = 1.2;
        var z = (oz - 1) * time / 1000 * speed;

        var ti = {
            img: image.img,
            rect: {
                x0: rect.x0 - (rect.x1 * z) / 2,
                y0: rect.y0 - (rect.y1 * z) / 2,
                x1: rect.x1 + (rect.x1 * z),
                y1: rect.y1 + (rect.y1 * z),
            },
            title: image.title
        }
    } else {
        var oz = (window.innerWidth - 200) / rect.x1;
        var speed = 3;
        var z = (oz - 1) * time / 1000 * speed;
        if (rect.y1 + (rect.y1 * z) > (window.innerHeight - 100)) {
            oz = (window.innerHeight - 100) / rect.y1;
            z = (oz - 1) * time / 1000 * speed;
        }

        var ti = {
            img: image.img,
            rect: {
                x0: 40,
                y0: 40,
                x1: rect.x1 + (rect.x1 * z),
                y1: rect.y1 + (rect.y1 * z),
            },
            title: image.title
        }
    }

    fgcontext.clearRect(0, 0, canvas.width, canvas.height);
    fgcontext.save();

    fgcontext.shadowColor = '#111';
    fgcontext.shadowBlur = 20;
    fgcontext.shadowOffsetX = 10;
    fgcontext.shadowOffsetY = 10;

    drawImage(ti, fgcontext);
    rect = ti.rect;
    fgcontext.restore();

    fgcontext.beginPath();
    th = 30;
    fgcontext.rect(rect.x0, rect.y0 + rect.y1 - th, rect.x1, th);
    fgcontext.fillStyle = "rgba(0,0,0,0.8)";
    fgcontext.fill();
    // context.restore()

    s = image.title + " [" + image.img.width + "x" + image.img.height + "]";
    fgcontext.font = '16pt Calibri';
    fgcontext.textAlign = 'right';
    fgcontext.fillStyle = '#1f1f1f';
    fgcontext.lineWidth = 4;
    fgcontext.strokeText(s, rect.x0 + rect.x1 - 8, rect.y0 + rect.y1 - 8);
    fgcontext.fillStyle = '#eee';
    fgcontext.font = '16pt Calibri';
    fgcontext.fillText(s, rect.x0 + rect.x1 - 8, rect.y0 + rect.y1 - 8);

    if (z >= oz - 1) {
        return;
    }

    requestAnimFrame(function () {
        zoom(key, startTime, in_zoom);
    });

}

function selectImage(key, in_zoom) {
    var startTime = (new Date()).getTime();
    zoom(key, startTime, in_zoom);
}

loadImages(sources, function (images) {
    recalc();
    next();
});

function next() {
    if (selectedImage.key == "" || Object.keys(images).indexOf(selectedImage.key) + 1 == Object.keys(images).length) {
        selectedImage.key = Object.keys(images)[0];
    } else {
        selectedImage.key = Object.keys(images)[Object.keys(images).indexOf(selectedImage.key) + 1];
    }
    selectImage(selectedImage.key, selectedImage.in_zoom);
}
function prev() {
    if (selectedImage.key == "" || Object.keys(images).indexOf(selectedImage.key) == 0) {
        selectedImage.key = Object.keys(images).slice(-1)[0];
    } else {
        console.log(Object.keys(images)[Object.keys(images).indexOf(selectedImage.key) - 1], Object.keys(images).indexOf(selectedImage.key))
        selectedImage.key = Object.keys(images)[Object.keys(images).indexOf(selectedImage.key) - 1];
    }
    selectImage(selectedImage.key, selectedImage.in_zoom);
}

function show() {
    reset();
    selectedImage.in_zoom = !selectedImage.in_zoom;
    selectImage(selectedImage.key, selectedImage.in_zoom);
}
function normal() {
    selectedImage.in_zoom = !selectedImage.in_zoom;
    selectImage(selectedImage.key, selectedImage.in_zoom);
}

document.addEventListener('keydown', function (e) {
    if (e.keyIdentifier == "Right") {
        next();
    }
    if (e.keyIdentifier == "Left") {
        prev();
    }
    if (e.keyIdentifier == "Enter") {
        if (selectedImage.in_zoom) {
            show();
        } else {
            normal()
        }
    }
});


</script>
</body>
</html>  
